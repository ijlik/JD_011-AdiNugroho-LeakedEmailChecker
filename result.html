<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Leaked Email â€” Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <h2 id="emailTitle"></h2>
    <div id="detailArea">Loading...</div>
  </div>
  <script>
    async function fetchDetails(email) {
      const res = await new Promise(resolve => {
        chrome.runtime.sendMessage({ type: "check-email", email }, r => resolve(r));
      });
      return res;
    }
    (async () => {
      const params = new URLSearchParams(location.search);
      const email = params.get("email");
      document.getElementById("emailTitle").textContent = email;
      const r = await fetchDetails(email);
      const area = document.getElementById("detailArea");
      if (!r) return area.textContent = "No response.";
      if (r.error) return area.textContent = "Error: " + r.message;
      const data = r.data;
      if (!data || !data.success || data.breaches_found === 0) {
        area.innerHTML = "<p>No known breaches for this email.</p>";
        return;
      }
      const breaches = data.data || [];
      area.innerHTML = `<p>Found ${data.breaches_found} breach(es).</p>`;
      const ul = document.createElement("ul");
      breaches.forEach(b => {
        const li = document.createElement("li");
        const breachDate = new Date(b.breach_date).toLocaleDateString();
        const description = b.description ? b.description.substring(0, 200) + "..." : "No description available";
        li.innerHTML = `
          <div style="margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
            <strong>${b.title || b.name}</strong> 
            <span style="color: #666;">(${breachDate})</span>
            <br><small style="color: #888;">${b.domain}</small>
            <br><strong>Exposed data:</strong> ${b.data_classes?.join(", ") || "Unknown"}
            <br><strong>Affected accounts:</strong> ${b.pwn_count?.toLocaleString() || "Unknown"}
            <br><small>${description}</small>
          </div>
        `;
        ul.appendChild(li);
      });
      area.appendChild(ul);
      // actionable advice
      const advice = document.createElement("div");
      advice.innerHTML = `<h3>Recommended actions</h3>
        <ol>
          <li>Change your password on affected services and any reuse across sites.</li>
          <li>Enable 2-factor authentication (2FA) where possible.</li>
          <li>Use a password manager to create unique passwords.</li>
          <li>Monitor accounts for suspicious activity.</li>
        </ol>`;
      area.appendChild(advice);
    })();
  </script>
</body>
</html>